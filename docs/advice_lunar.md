思路是：把“太阳方向 + 观察方向（相机/地球方向）”当作两根矢量喂给月球，月相就是它们之间的几何关系的结果。下面给你一条仅月球的完整实现路径（不写代码，步骤清晰可落地）。

0. 目标与前提

目标：给定日期（UTC）→ 计算月相并正确渲染（弦月/盈亏、明暗边界与方向），月球完全独立于地球场景光照。

前提：地球是“假地球/展示地球”，不参与月相计算；观察者默认在地球附近（可忽略视差），相机就是“地球方向”。

1. 输入与坐标

输入：UTC 日期时间（必要），可选观测点经纬高（用于更严谨的“明暗边界方向”/位置角）。

坐标系：选一个全局右手系（例如 three.js 世界系）。后续所有向量都转到这个系。

2. 太阳与月球的天体矢量（两档精度）

你只需方向即可（距离只影响大小/地球辉等次要项）。

快速近似（MVP 足够）

计算太阳 ecliptic/equinox J2000 方向向量 S（地球→太阳）。

计算月球 geocentric 方向向量 M（地球→月球）。

常用简化历书（Meeus 级别）即可做到 <1° 量级的相位/位置精度，完全够演示。

高精度（可选）

用 VSOP87（太阳/地球）+ ELP2000（月球）或离线表/内置系数库；或在本地接 JPL DE430/431（成本高，不必上云）。

3. 相机/观察方向

设相机指向月球；观察方向 O 定义为月球看向相机的单位向量。

若相机在地球附近，可取 O ≈ -M（从月球指向地球/相机）。

这保证“近月面（贴图 0°经线）面对相机”，符合“始终看见近月面”的体验。

4. 月相核心几何

相位角 i（Sun–Moon–Observer 的夹角，顶点在月球）：
cos i = dot( Ŝ, Ô )，其中 Ŝ 是“月球→太阳”的单位向量（与第2步一致即可），Ô 是第3步。

可见被照亮比例（illumination fraction）
k = (1 + cos i) / 2（0=新月，1=满月）。

明暗边界（终止线）方向

在“天球投影面”（垂直于观察方向 Ô）上，终止线是与太阳投影垂直的弧。

计算太阳在观测平面的投影：S_proj = normalize( Ŝ - dot(Ŝ, Ô) * Ô )

终止线的大致“朝向”在屏幕上与 S_proj 垂直（这决定了“上弦/下弦”在屏幕上的旋转角）。

这三步就把“亮多少、朝哪边亮、弦的旋转角”都确定了。

5. 渲染参数（仅月球）

月球朝向：用四元数把月球模型的“贴图中央经线朝向”（例如本地 +Z 轴）对齐到 Ô，保证近月面一直朝相机。

定向光：在月球局部空间放一盏“太阳”方向光，方向取 Ŝ；强度按需要调节。

材质：

MVP：MeshStandard/Physical + 方向光（禁用所有场景灯对它的影响，见你前面定的双通道/隔离策略）。

更真实：自定义相位函数（back-scattering/哈尼相近似）、压暗 terminator 附近。

环境光/IBL：默认不用（避免破坏相位对比）。如需“地球辉”（薄弦时暗面微亮），加一个很弱的环境分量或一盏来自 -Ŝ 的极弱 fill light。

6. 与“假地球”完全解耦（两种管线任选）

锁月＋单通道（推荐）：日期改变 → 计算 Ŝ、Ô、i → 渲月球到 RenderTarget 得到相位贴图 → 常规帧只渲地球，月球用烘焙贴图显示（unlit）。

双通道逐帧：一帧两次 render：先月球（只开“太阳光”），后地球（只开地球灯光/大气）。月球深度先写入，遮挡关系自然正确。

7. 纹理基准与“正面始终朝屏”的细节

选一张IAU 东经为正的月球漫反射贴图（0°经线位于近月面中央）。

纹理坐标与模型轴约定：让模型的“经度 0°”朝本地 +Z 且“北极”在+Y；这样把 +Z 对齐到 Ô 即可“正面朝屏”。

若要更科学的“天球旋转”（终止线倾角会随赤纬变化）：按第4步的 S_proj 计算一个屏幕内旋转角，对月球做额外绕 Ô 的自转即可。

8. 进阶可选项

视差/地心 vs. 顶点观测：高要求时，用观测者经纬高把 Ô 从“地心方向”微调为“站在某地看月球的方向”。

月球天平动（libration）：若想更真实，可按近似模型加入经/纬方向的小角度摆动（几度量级），会看到“边缘特征”露出/隐藏。

地球辉（Da Vinci glow）：当 k 很小，给暗面加一份来自 Ô 的极弱 diffuse 以模拟地球反照。

食相：不依赖真实地球也可做（几何遮挡/阴影贴图），但属于扩展。

9. 验收要点（单月球）

改日期（朔→上弦→望→下弦），k 单调变化，外观一致。

旋转相机（不改日期），弦月的“亮边方向”在屏幕上只随相机旋转而整体旋转，相位不变。

关闭场景所有灯光，月球仍能按自定义“太阳光”正确显示；“假地球”灯光对月球零影响。

切换/调节 scene.environment（如果地球用 IBL），月球不变（你已隔离/未使用 IBL）。

小结

是的：这套方案能准确写入月相，而且完全不需要真实地球参与计算。

你只要：① 日期 → ② 算出 Ŝ（太阳方向）和 Ô（观察方向） → ③ 用上面几何关系确定亮度比例与终止线方向 → ④ 渲染时把月球当作一个独立受光体处理即可。

业务上：月相低频变更 → 推荐“锁月＋单通道复用”；想保持完全物理几何 → 也可以走“双通道逐帧”。